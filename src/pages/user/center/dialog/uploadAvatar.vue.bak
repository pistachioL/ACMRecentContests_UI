<template>
  <div id="app">
<!--    <el-dialog title="请选择你的头像" :visible.sync="dialogFormVisible">-->
      <el-upload
              action="https://sm.ms/api/v2/upload"
              :limit="1"
              :http-request="myUpload"
              :show-file-list="false"
              :on-exceed="handleExceed"
              :headers="headers"
              :file-list="fileList"
              :before-upload="beforeAvatarUpload">
<!--        <i class="el-icon-upload"></i>-->
<!--        <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>-->
<!--        <div class="el-upload__tip" slot="tip">只能上传jpg/png文件，且不超过1MB</div>-->
      </el-upload>
<!--    </el-dialog>-->
  </div>
</template>

<script>
  import axios from 'axios';
  export default {
    data() {
      return {
        dialogFormVisible: false,
        headers:{
          'Content-Type': 'multipart/form-data',
          'Authorization': 'vqLCDJkAyrqLpVMiEKxVFePA039N8Jx2'
        },
        userId: '',
        fileList: []
      };
    },
    methods: {
      myUpload(content) {
        let formData = new FormData();
        formData.append('smfile', content.file); // 'file[]' 代表数组 其中`file`是可变的
        console.log(content.action)
        axios.post(content.action, formData).then(res =>{
              console.log((res))
            }).catch(err =>{
              console.log(err)
        })

        // request.post(content.action, formData).then(rs => {
        //   this.$store.dispatch('GetInfo')
        // }).catch(err => {
        //   this.$store.dispatch('LogMessage', "用户头像上传失败!")
        //   console.log(err)
        // })
      },
      beforeAvatarUpload(file) {
        const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';
        const isLt2M = file.size / 1024 / 1024 < 1;
        if (!isJPG) {
          this.$message.error('上传头像图片只能是 JPG/PNG 格式!');
        }
        if (!isLt2M) {
          this.$message.error('上传头像图片大小不能超过 1MB!');
        }
        return isJPG && isLt2M;
      },
      handleExceed(files, fileList) {
        this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
      },
      open(){
        this.dialogFormVisible = true
      }
    }
  }
</script>